# FAQ

Часто задаваемые вопросы о Media Processing Service (MPS) и устранении распространённых проблем.

---

## Основы

### Понятия

**В: Что такое MPS?**

Media Processing Service (MPS) — это облачный сервис транскодирования и аудио-видео обработки, способный обрабатывать большие объёмы данных. Вы можете использовать его для транскодирования видео, хранящихся в Tencent Cloud COS или AWS S3, чтобы сделать их пригодными для OTT-сервисов или воспроизведения на ПК и мобильных устройствах. Также можно транскодировать видео в разные битрейты и разрешения для различных платформ.  
Другие возможности MPS включают наложение водяных знаков, создание скриншотов видео, улучшение аудио и видео, интеллектуальный анализ, интеллектуальное распознавание, запись прямых трансляций и многое другое.

**В: Что такое видеобитрейт?**

Видеобитрейт — это количество бит данных, передаваемых за единицу времени. Обычно измеряется в Kbps (килобит в секунду).

Формула: **Битрейт (Kbps) = Размер файла (KB) × 8 ÷ Время передачи (с)**

**В: Что такое TESHD в MPS?**

TESHD (Top Speed Codec High Definition) — это процесс обработки видео, направленный на снижение потребления полосы пропускания при сохранении или улучшении качества видео. Он позволяет доставлять пользователям видео более высокого качества при меньшем использовании пропускной способности.

**В: Использует ли MPS аппаратное или программное декодирование?**

MPS предоставляет сервисы обработки видео, такие как облачное транскодирование, наложение водяных знаков, генерация превью и улучшение аудио и видео. Услуги декодирования MPS не предоставляет.

---

### Функциональные возможности

**В: Предоставляет ли MPS тестовые аккаунты?**

Нет. Если вам требуется тестирование, вы можете связаться с коммерческой командой Tencent Cloud для получения тестовых ваучеров.

**В: Какие режимы создания скриншотов поддерживает MPS?**

MPS поддерживает:
- Скриншот по временной точке (одиночные скриншоты)
- Выборочные скриншоты (несколько скриншотов)
- Спрайт-скриншоты
- Анимированные скриншоты

Подробности см. в документации по шаблонам скриншотов.

**В: Поддерживается ли одновременное выполнение нескольких задач обработки для одного входного источника?**

Да. В оркестрации можно добавить несколько узлов обработки для выполнения различных операций над одним и тем же входным файлом.

**В: Поддерживает ли MPS склейку видео?**

Да. Через консоль склейка недоступна, но вы можете вызвать API **EditMedia** для программной склейки видео.

**В: Можно ли преобразовать аудио из видео в текст?**

Да. После выполнения распознавания контента видео через MPS Video Content Recognition результат будет содержать текст, распознанный из аудиодорожки видео. Подробности см. в разделе интеллектуального распознавания видео.

**В: Можно ли установить интеллектуальную обложку в виде анимированного изображения?**

Интеллектуальное извлечение обложки выбирает один или несколько скриншотов видео в качестве рекомендуемой обложки. Автоматическая генерация анимированных изображений этим способом не поддерживается.

Если требуется анимированная обложка, вы можете:
1. Интеллектуально создать клип-хайлайт с помощью функции Intelligent Analysis – Highlight Clipping  
2. После выбора подходящего сегмента использовать функцию Animated Screenshot для получения анимированного изображения

**В: Можно ли одновременно настроить несколько выходных директорий в оркестрации?**

Да. Например, для узла аудио/видео транскодирования это настраивается через **More Settings > Customize Transcoding Output Path**. Также можно изменить правило именования выходных файлов с помощью переменных имени файла.

**В: Поддерживает ли MPS сегментацию видео?**

Да. При использовании формата упаковки HLS можно настроить формат сегментации и формат разбиения данных:
- **Segment File (segment)** — несколько сегментных файлов
- **Single File (single-file)** — один файл с поддержкой byte range (примечание: не все HLS-устройства и плееры поддерживают этот режим)

**В: Поддерживает ли MPS HDR?**

Да. Функция улучшения аудио и видео поддерживает включение HDR и позволяет выбирать один из режимов:
- **HDR10**
- **HLG (Hybrid Log-Gamma)**

Примечание: для использования HDR стандарт кодирования должен быть установлен в H.265. В противном случае задача обработки завершится ошибкой.

---

## Авторизация аккаунта

### Сценарий 1 (обязательно): сервис MPS не включён для аккаунта

**Проблема:** Если сервис MPS не активирован для аккаунта, вы не сможете использовать MPS.

**Решение:**
1. Свяжитесь с владельцем корневого аккаунта и войдите под корневым аккаунтом  
2. Перейдите в консоль MPS и нажмите **Activate For Free**

Альтернативно, если субаккаунт имеет полные права чтения и записи для MPS, он может активировать MPS самостоятельно.

---

### Сценарий 2 (обязательно): у субаккаунта нет прав на операции MPS

**Проблема:** Сообщение об ошибке:  
"You do not have permission to operate Media Processing Service - DescribeUserInfo"  
или  
"AuthFailure. Unauthorized Operation"

**Решение 1: Назначить субаккаунту политику QcloudMPSFullAccess (рекомендуется)**

1. Войти под корневым аккаунтом  
2. Перейти в Cloud Access Management > Users  
3. Найти нужный субаккаунт  
4. Нажать **Authorize** и найти **QcloudMPSFullAccess**  
5. Назначить эту предустановленную политику субаккаунту

**Решение 2: Назначить субаккаунту пользовательскую политику**

1. Перейти в Cloud Access Management > Policies  
2. Нажать **Create Custom Policy** и выбрать **Create by policy builder**  
3. Выбрать сервис **Media Processing Service (mps)**  
4. Выбрать необходимые действия (Read, Write или конкретные операции)  
5. В разделе Resource выбрать **All resources**  
6. Задать имя политики  
7. Назначить политику субаккаунту  
8. Нажать **Done**

---

### Сценарий 3 (необязательно): MPS не авторизован для чтения/записи файлов в бакетах

**Проблема:** Задачи завершаются ошибкой при попытке доступа к COS или VOD Pro без соответствующей авторизации.

**Решение:**

**Для COS:**
1. Войти под корневым аккаунтом  
2. Перейти на главную страницу консоли MPS  
3. Нажать **COS Authorization** → **Authorize**  
4. Роль **MPS_QcsRole** будет создана автоматически

**Для VOD Pro:**
1. Войти под корневым аккаунтом  
2. Перейти на главную страницу консоли MPS  
3. Нажать **VOD Authorization**  
4. Роль **MPS_QCSLinkedRoleInVOD** будет создана автоматически

**Для AWS S3 или URL:**
- Авторизацию COS можно пропустить  
- Убедитесь, что URL публично доступен и поддерживает прямую загрузку

> **Примечание:** Эти операции авторизации не требуют включения COS/VOD и не приводят к начислению платы. Они лишь предоставляют MPS необходимые API-права на чтение и запись.

---

### Сценарий 4 (необязательно): у субаккаунта нет разрешения cam:GetRole

**Проблема:** Сообщение об ошибке:  
"You do not have permission to operate on resource role/xxxx Get Role Detail"

**Пояснение:**  
Фронтенд консоли MPS вызывает API GetRole для проверки наличия сервисной роли MPS_QcsRole. Если у субаккаунта нет разрешения cam:GetRole, консоль не может получить информацию о роли и отображает ошибку. API при этом продолжает работать — проблема затрагивает только доступ через консоль.

**Решение:**
1. Войти под корневым аккаунтом  
2. Перейти в Cloud Access Management > Policies  
3. Нажать **Create Custom Policy** → **Create by policy generator**  
4. Выбрать сервис **Cloud Access Management (CAM)**  
5. Выбрать операцию чтения **GetRole**  
6. Выбрать **All resources**  
7. Задать имя политики  
8. Назначить политику субаккаунту  
9. Нажать **Complete**

---

## Конфигурация задач

**В: Как получать callback-уведомления?**

MPS поддерживает следующие способы callback-уведомлений:
- Очереди сообщений (CMQ)
- Облачные функции (SCF)
- HTTP-push

**В: Что делать, если callback-уведомления не приходят?**

Возможные причины:
1. Некорректная настройка workflow  
2. Если задача запущена через API — используйте **DescribeTaskDetail** для проверки статуса  
3. Очередь сообщений переполнена — создайте тикет для проверки

**В: Как настроить callback?**

Подробные инструкции см. в разделе настройки callback-уведомлений.

**В: Взимается ли плата за callback?**

- **CMQ** — см. описание стоимости CMQ  
- **SCF** — см. обзор тарификации SCF  
- **HTTP-push** — в настоящее время бесплатно

**В: Как настроить автоматический запуск задач?**

1. Завершите настройку оркестрации  
2. Перейдите в **Orchestrations > Offline Orchestration**  
3. Нажмите **Enable**  
4. Файлы, загруженные в триггерный бакет, будут обрабатываться автоматически

---

## Запуск задач

**В: Что делать, если автоматический триггер включён, но задачи не запускаются?**

Возможные причины и решения:

1. **Ошибка загрузки файла** — при ошибках 4XX или 5XX событие COS не создаётся  
   - Решение: убедитесь, что файл успешно загружен

2. **Загрузка успешна, но обработка не запускается** — возможны ошибки конфигурации оркестрации  
   - Решение: проверьте настройки оркестрации

**В: Что делать, если запуск задачи завершился ошибкой?**

Возможные причины:
1. Некорректные параметры запроса  
2. Отсутствие авторизации для COS или CMQ  
3. Ошибки прав доступа аккаунта или субаккаунта

**В: Что делать, если задача успешно запущена, но завершилась ошибкой обработки?**

Ошибка может возникнуть в любом подзадаче (транскодирование, скриншоты, водяные знаки, интеллектуальное распознавание, интеллектуальный анализ).

**Решения по типу ошибки:**
1. Некорректные метаданные файла или неподдерживаемый формат  
2. Ошибки в настройках шаблона  
3. Прочие ошибки — создайте тикет

**В: Возникает ли зацикливание, если директория триггера и выходная директория совпадают?**

Нет. Совпадение путей не вызывает зацикливание.

**В: Каково максимальное количество параллельных каналов транскодирования?**

По умолчанию — **60**. Для увеличения лимита создайте тикет.

---

## Просмотр результатов задач

**В: Как получить метаданные медиафайла?**

Используйте API **DescribeMediaMetaData**.

**В: Можно ли запрашивать недавно завершённые задачи с помощью ScrollToken?**

Не всегда, так как задачи возвращаются в порядке времени создания.

> **Примечание:** ScrollToken используется для постраничного вывода.

**В: Как получить список задач?**

Используйте API **DescribeTasks**.

**В: Как добавить анимированные водяные знаки?**

1. Конвертируйте анимированное изображение в формат APNG  
2. Добавьте его как водяной знак в настройках workflow

**В: Как изменить шаблон водяного знака?**

Используйте API **ModifyWatermarkTemplate**.

**В: Как связать MPS с COS-бакетами?**

При настройке workflow выберите триггерный бакет. Видео, загруженные в него, будут обрабатываться автоматически.

**В: OCR-результаты получены для кадра. Как получить сам кадр?**

1. Определите временную точку  
2. Используйте API **ProcessMedia** с параметром **SnapshotByTimeOffsetTaskInput**  
3. Передайте временную метку

**В: Как просмотреть статистику?**

1. Войти в консоль MPS  
2. Открыть **Usage Statistics**  
3. Просмотреть использование ресурсов  
4. Отслеживать динамику затрат

---

## Чек-лист устранения проблем

- [ ] Сервис MPS активирован  
- [ ] У аккаунта есть необходимые права  
- [ ] COS/VOD Pro авторизованы  
- [ ] Входные файлы доступны и поддерживаются  
- [ ] Проверены параметры шаблонов  
- [ ] Оркестрация настроена корректно  
- [ ] Проверены триггерные и выходные бакеты  
- [ ] Использован **DescribeTaskDetail** для диагностики  
- [ ] Проверена настройка callback  
- [ ] Создан тикет при необходимости

---

## Связанные материалы

- [Руководство по началу работы](/quickstart/quickstart.md)
- [Задачи транскодирования](/operations/transcoding-tasks.md)
- [Справочник API](/api-ref.md)
- [Тарификация](/pricing.md)

