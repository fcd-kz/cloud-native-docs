# Интеграция записи прямых трансляций

## Обзор

Функция записи прямых трансляций в MPS захватывает live-потоки и сохраняет их в виде файлов для последующего воспроизведения по запросу (on-demand). В этом руководстве описано, как настроить шаблоны, схемы (schemes) и задачи для записи прямых трансляций.

## Шаги настройки записи live-трансляций

### Шаг 1 — Создание шаблона записи live-трансляции

Шаблон определяет, каким образом поток будет записываться и сохраняться. При создании шаблона записи live-трансляции необходимо задать следующие параметры:
- Контейнер записи (например, HLS или MP4).
- Длительность сегмента (для HLS).
- Шаблон именования файлов записи.

### Шаг 2 — Создание схемы live-обработки

Схема связывает шаблон с конкретным источником входных данных и выходным хранилищем. Для её создания:
1. Выберите COS-бакет и директорию источника, куда будет поступать исходный поток.
2. Добавьте шаг **Live Recording** и выберите ранее созданный шаблон записи.
3. Укажите выходной COS-бакет и путь, в котором будут сохраняться записанные файлы.
4. Сохраните автоматически сгенерированную случайную строку в выходном пути — её удаление может привести к тому, что несколько задач будут перезаписывать результаты друг друга.

### Шаг 3 — Запуск задачи записи live-трансляции

После подготовки схемы:
1. Перейдите на страницу **Live tasks management** в консоли MPS.
2. Нажмите **Create task** и укажите URL live-потока, который необходимо записать.
3. Выберите схему, созданную на шаге 2.
4. Отправьте задачу. MPS начнёт получать поток, записывать сегменты в соответствии с шаблоном и сохранять их по указанному пути.

**Примечание:** Система пытается получить live-поток до трёх раз. Если после трёх попыток поток не удаётся получить, задача записи завершается с ошибкой.

## Управление задачами записи live-трансляций

Все активные и завершённые задачи записи отображаются в списке **Live tasks management**. Вы можете:
- Проверять статус задачи (в процессе, завершена, ошибка).
- Просматривать детали, такие как время начала и окончания, а также размер файлов.
- При необходимости вручную останавливать выполняющуюся задачу.

## Best practices

- Используйте короткую длительность сегментов (например, 5–10 секунд) для HLS, чтобы обеспечить плавное воспроизведение записей при on-demand-доставке.
- Храните записи в бакетах, отличных от источника исходного live-потока, чтобы избежать случайной перезаписи данных.
- Отслеживайте выполнение задач через консоль или API и настраивайте callback-уведомления для автоматического оповещения о завершении записи.
