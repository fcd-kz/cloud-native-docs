# Интеграция аудио/видео транскодирования

## Обзор

Транскодирование преобразует исходный аудио- или видеопоток в другой поток путём изменения таких параметров, как кодек, разрешение и битрейт. Этот офлайн-процесс адаптирует медиаконтент под различные устройства и сетевые условия. MPS поддерживает несколько типов транскодирования для **видео** — стандартное, Top Speed Codec (TSC), адаптивный битрейт-стриминг и Remux — и для **аудио** — стандартное, TSC и адаптивный битрейт-стриминг.

- **Стандартное транскодирование:** снижает битрейт и изменяет стандарт кодирования, разрешение или частоту кадров.
- **TSC-транскодирование:** улучшенная функция, оптимизирующая видео и аудио для обеспечения высокого качества (HD) при одновременном снижении потребления пропускной способности.
- **Адаптивный битрейт-стриминг:** преобразует исходный файл в несколько потоков с разным битрейтом, чтобы конечные пользователи могли выбирать подходящую версию в зависимости от сетевых условий.
- **Remux:** изменяет только формат контейнера видео без повторного кодирования.

## Технические преимущества

Freedom Cloud MPS предоставляет широкий набор методов кодирования (например, VP8, H.264, VP9, H.265, AV1, AVS3, H.266), позволяющих значительно снизить битрейт без потери качества.  
Top Speed Codec использует интеллектуальное динамическое кодирование для повышения субъективного качества, поддерживает кодирование в реальном времени вплоть до разрешения 8K и интегрирует такие технологии, как super-resolution, HDR и Dolby Vision / Dolby Atmos.  
Распределённое транскодирование на множестве инстансов ускоряет выполнение задач и снижает затраты на пропускную способность.

## Создание задач

MPS предоставляет три способа создания задач транскодирования.

### Способ 1 — Консоль (без кода)

1. В консоли MPS нажмите **Create Task > Create VOD Processing Task**.
2. **Укажите входной файл:** выберите файл из COS или AWS S3 либо укажите URL для загрузки.
3. **Добавьте узел Transcoding** в workflow.
4. **Выберите шаблон или настройте параметры вручную** в окне настроек транскодирования.
5. **Укажите выходной путь** и нажмите **Create**, чтобы запустить задачу.

### Способ 2 — API

Используйте API **ProcessMedia**:

- **Указание ID шаблона:** передайте информацию о входном и выходном хранилище и добавьте `TranscodeTaskSet` с ID шаблона.
- **Указание ID оркестрации:** для сложных сценариев используйте Schedule ID вместо `TranscodeTaskSet`.

Дополнительные параметры (`StdExtInfo`) позволяют выполнять расширенные настройки, такие как включение пакетов тишины в аудиопотоках или загрузка результатов в сторонние хранилища (OSS, AWS S3) с указанием бакета, региона, учётных данных и HTTP-заголовков.

### Способ 3 — Автоматический триггер

Для автоматического транскодирования файлов, загружаемых в COS-бакет:

1. При создании задачи нажмите **Save the Orchestration** и настройте триггерный бакет и директорию.
2. В списке VOD-оркестраций включите оркестрацию. После короткого периода активации конфигурация начнёт действовать.
3. Файлы, добавленные в триггерную директорию, автоматически запускают задачи транскодирования, а результаты сохраняются по заданному выходному пути.

## Запрос результатов задач

- **Callback-уведомления:** при вызове `ProcessMedia` можно указать `TaskNotifyConfig`, чтобы MPS отправлял уведомления после завершения задачи.
- **DescribeTaskDetail:** запросите статус и результат задачи, передав её Task ID в API `DescribeTaskDetail`.
- **Консоль:** на странице задач обработки VOD отображаются все задачи; после успешного выполнения подзадач можно просмотреть или скачать выходные файлы.

## Дополнительные возможности

- **Водяные знаки:** при создании задачи транскодирования можно добавить шаблоны водяных знаков. При использовании API передайте `WatermarkSet` внутри `TranscodeTaskSet`.
- **Субтитры (жёсткие субтитры):** можно встроить субтитры непосредственно в видео. В консоли доступен выбор файла или дорожки субтитров и настройка стиля; API поддерживает аналогичные параметры. Встраивание субтитров тарифицируется как транскодирование.
- **Пакеты тишины и пользовательские хранилища:** используйте `StdExtInfo` для включения пакетов тишины при разрывах аудиофреймов или для загрузки результатов в сторонние хранилища.
