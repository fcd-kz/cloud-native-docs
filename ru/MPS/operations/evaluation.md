# Оценка качества видео

## Обзор

Оценка качества измеряет визуальную точность (fidelity) обработанных видео. MPS предоставляет инструменты объективного скоринга, которые сравнивают исходное видео с обработанной версией, помогая разработчикам проверять улучшения или деградации (regressions) при кодировании, улучшении и других шагах обработки. Оценку также можно выполнять для одного видео без эталона (reference), чтобы оценить общее качество.

## Возможности

- **Объективные метрики:** Поддерживаются метрики VMAF (Video Multimethod Assessment Fusion), PSNR (Peak Signal-to-Noise Ratio), SSIM (Structural Similarity) и VMAF-NEG (расширенный вариант VMAF). Эти метрики оценивают, насколько обработанное видео близко к исходному.
- **Расчёт BD-Rate:** Вычисляет экономию битрейта (Bit-Difference Rate) между двумя настройками кодирования при сохранении сопоставимого качества.
- **Гибкая сегментация:** Позволяет оценивать всё видео или конкретные временные сегменты (например, 00:02:00–00:05:00) для более точечного анализа.
- **Сравнение разных форматов:** Оценивает видео с разными разрешениями или кодеками, чтобы сравнить качество при понижении разрешения (down-converting) или повторном кодировании (re-encoding).

## Создание задач оценки

1. **Консоль:** Перейдите в “Quality Evaluation” в консоли MPS и нажмите **Create Task**. Загрузите или выберите исходное и сравниваемое видео из COS. Выберите метрику (VMAF, PSNR, SSIM) и необязательные настройки, такие как частота выборки кадров (frame sampling rate) и диапазон оценки (evaluation range). Назначьте выходную директорию и отправьте задачу.
2. **API:** Используйте `ProcessMedia` с параметром `AiQualityControlTask` или `VideoQualityEvaluationTask`. Укажите ID шаблона (или выберите метрики по умолчанию) вместе с входным (input) и эталонным (reference) видео. Настройте выходное хранилище и путь, а также callback-уведомления.
3. **Автоматическая оркестрация:** Включите задачи оценки в workflow — например, после транскодирования или улучшения — чтобы автоматически формировать отчёты для каждого обработанного файла.

## Интерпретация результатов

Результаты оценки обычно включают:

- **Общий скор:** Числовые значения по каждой метрике (например, VMAF = 92).
- **Покадровый анализ:** Таймлайн значений метрики по оцениваемому сегменту, показывающий пики и провалы.
- **BD-Rate:** Процент, показывающий экономию или рост битрейта между конфигурациями кодирования.

Более высокие значения VMAF и SSIM означают лучшее воспринимаемое качество, а более низкие значения BD-Rate — большую эффективность.

## Best practices

- **Используйте высококачественный эталон:** Эталонное видео должно быть максимально качественной доступной версией. Точность оценки ограничена качеством эталона.
- **Выбирайте подходящие метрики:** Для воспринимаемого качества VMAF обычно надёжнее; PSNR и SSIM проще, но хуже соответствуют человеческому восприятию.
- **Сегментируйте длинные видео:** Оценка многочасовых видео может быть вычислительно дорогой. Фокусируйтесь на критичных сценах или репрезентативных сегментах.
- **Осторожно сравнивайте разные разрешения:** Если разрешения отличаются, перед оценкой приведите их к общему разрешению (upsample/downsample), чтобы избежать вводящих в заблуждение результатов.
