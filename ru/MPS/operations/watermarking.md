# Интеграция цифровых и видимых водяных знаков

## Обзор

MPS поддерживает два типа водяных знаков:

- **Цифровой водяной знак:** Встраивает невидимую текстовую информацию в видеопоток. Поддерживаются как базовый авторский водяной знак, так и форензик-водяной знак **NAGRA NexGuard**.
- **Видимый водяной знак:** Добавляет пользовательские изображения (PNG или JPG) или текст поверх видео для защиты авторских прав или брендинга.

## Цифровой водяной знак

### Версии и биллинг

- **Базовый авторский водяной знак:** Обеспечивает встраивание невидимого текста.
- **Форензик-водяной знак NAGRA NexGuard:** Обладает высокой скрытностью и устойчивостью к удалению, предназначен для контента высокой ценности.
- **Биллинг:** Добавление цифрового водяного знака тарифицируется по длительности выходного видео. Поскольку цифровой водяной знак зависит от транскодирования или улучшения, взимается плата как за добавление водяного знака, так и за базовое транскодирование/улучшение. Извлечение цифрового водяного знака тарифицируется за каждый API-вызов.

### Создание шаблона

Войдите в консоль и создайте шаблон цифрового водяного знака. Каждый пользователь может создать до 50 шаблонов NexGuard. Шаблоны нельзя изменять или удалять через консоль; для внесения изменений требуется помощь backend-поддержки.

### Запуск добавления цифрового водяного знака

- В консоли создайте офлайн-задачу обработки, добавьте узел **Audio/Video Transcoding**, включите опцию цифрового водяного знака и привяжите соответствующий шаблон. Цифровой водяной знак также можно включить при использовании функции улучшения.
- Через API вызовите **ProcessMedia** и укажите ID шаблона транскодирования и ID шаблона цифрового водяного знака в параметре `BlindWatermark`.
- В одну задачу можно добавить до десяти видимых водяных знаков; для цифрового водяного знака требуется только один ID шаблона на задачу.

### Автоматический триггер

Чтобы автоматически добавлять цифровые водяные знаки при загрузке файлов в COS:

1. Сохраните оркестрацию при создании задачи и настройте триггерный бакет/директорию.
2. Включите оркестрацию; после активации новые файлы в директории будут автоматически запускать задачи добавления водяных знаков.

### Извлечение цифрового водяного знака

- Используйте страницу **Digital Watermark Extraction** в консоли, чтобы выбрать видео и извлечь базовый водяной знак. Для извлечения NexGuard требуется обращение в поддержку.
- Через API вызовите **ExtractBlindWatermark**, указав тип водяного знака (`blind-basic` для базового), а также COS-бакет, регион и путь к объекту.

## Видимый водяной знак

### Биллинг

Добавление видимого водяного знака **не** влечёт дополнительных затрат.

### Создание шаблона

Создайте шаблон видимого водяного знака в консоли; поддерживаются как изображения, так и текстовые водяные знаки.

### Запуск добавления видимого водяного знака

- В консоли создайте офлайн-задачу обработки, выберите узел транскодирования и включите опцию видимого водяного знака. Привяжите шаблон водяного знака; можно добавить до **десяти** изображений или текстовых водяных знаков. Видимые водяные знаки также можно включать при улучшении или создании скриншотов.
- Через API вызовите **ProcessMedia** и передайте `WatermarkSet` с ID шаблона водяного знака.

### Автоматический триггер

Задачи с видимыми водяными знаками используют тот же механизм автоматического запуска на основе оркестраций, что и цифровые водяные знаки.
