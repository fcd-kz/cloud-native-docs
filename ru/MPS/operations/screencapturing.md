# Интеграция создания скриншотов видео

## Обзор

Создание скриншотов — это офлайн-задача, при которой из видео извлекается изображение в заданный момент времени. MPS поддерживает несколько режимов создания скриншотов:

- **Скриншот по времени (time-point screenshot):** создание скриншотов в указанные временные точки.
- **Сэмплированные скриншоты (sampled screenshot):** захват кадров через равные интервалы.
- **Image sprite:** захват серии скриншотов с интервалами и объединение их в одно изображение.
- **Анимированные скриншоты:** преобразование сегмента видео в анимированный GIF или WebP.

Типовые сценарии использования включают генерацию превью и обложек видео, создание подборок хайлайтов, помощь в ручной модерации, формирование видеосводок и отображение миниатюр на шкале прогресса плеера.

## Шаблоны скриншотов

Скриншоты настраиваются с помощью **шаблонов**. Вы можете использовать предустановленные шаблоны или создавать собственные в консоли. Основные параметры:

### Шаблоны скриншотов по времени

- **Format:** формат выходного изображения (в настоящее время поддерживается только JPG).
- **Width и Height:** размеры изображения в пикселях (128–4096).
- **FillType:** способ обработки несовпадения пропорций сторон — варианты включают **Scale to fill** (растяжение), **Black bars**, **White bars** и **Gaussian blur**.

### Шаблоны сэмплированных скриншотов

- Те же параметры, что и у скриншотов по времени (формат, ширина, высота).
- **SampleType:** определяет способ измерения интервалов — **по проценту** (например, Interval = 5 %) или **по времени** (например, Interval = 10 с).
- **Interval:** значение интервала для выбранного способа измерения.
- **FillType:** те же варианты заполнения, что и выше.

### Шаблоны Image Sprite

- **Format:** в настоящее время поддерживается только JPG.
- **Width / Height:** размер каждого подизображения.
- **Rows / Columns:** количество строк и столбцов в sprite.
- **SampleType:** в настоящее время поддерживается только выборка по времени.
- **Interval:** интервал выборки (в секундах).
- Убедитесь, что значения width × columns и height × rows находятся в диапазоне 128–4096 пикселей.

### Параметры анимированных скриншотов

- **Format:** GIF или WebP.
- **Width / Height:** размеры изображения (128–4096 px).
- **FPS:** частота кадров (1–60).

## Запуск задач создания скриншотов

Запуск задач возможен через API или консоль:

1. **API:** Вызовите **ProcessMedia** и укажите ID шаблона скриншотов в `MediaProcessTask.SnapshotByTimeOffsetTaskSet`.  
   Для сэмплированных скриншотов используйте `SampleSnapshotTaskSet`.  
   Для image sprite используйте `ImageSpriteTaskSet`.  
   Вы также можете автоматически запускать задачи при загрузке видео, указав параметр `procedure` с именем task flow, созданного в консоли.
2. **Консоль:** Создайте task flow в консоли, добавьте шаг создания скриншотов и настройте параметры шаблона; затем запустите flow для выбранных видео или назначьте его как автоматическую процедуру для обрабатываемых загрузок.

## Получение результатов

После завершения задачи создания скриншотов вы можете:

- **Получать уведомления:** Укажите `TaskNotifyConfig` при вызове `ProcessMedia`, чтобы получать асинхронные callback-уведомления. Уведомление содержит Task ID, информацию о файлах и результаты по каждому типу скриншотов с временными смещениями и URL изображений.
- **Запрашивать через API:** Используйте `DescribeTaskDetail` с Task ID для синхронного получения статуса и результатов.
- **Через консоль:** На странице управления VOD-задачами доступны просмотр и скачивание созданных изображений.

## Best practices

- **Выбирайте подходящие шаблоны:** используйте скриншоты по времени для обложек, сэмплированные скриншоты — для модерации или извлечения хайлайтов, image sprite — для суммаризации длинных видео.
- **Аккуратно настраивайте режимы заполнения:** чёрные/белые поля или Gaussian blur сохраняют пропорции без искажений.
- **Автоматизируйте через task flow:** создавайте и сохраняйте task flow в консоли и привязывайте их к процедурам загрузки, чтобы новые видео обрабатывались автоматически без ручного вмешательства.
